#:kivy 2.2.1

<ProfileSetupScreen>:
    name: 'profile_setup'
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1  # White background
        Rectangle:
            pos: self.pos
            size: self.size

    ScrollView:
        do_scroll_x: False
        do_scroll_y: True
        
        BoxLayout:
            orientation: 'vertical'
            padding: dp(15)  # Reduced padding
            spacing: dp(10)  # Reduced spacing
            size_hint_y: None
            height: self.minimum_height

            Image:
                source: 'D:\Safinity\screens\profile\profile_icon.png'  # Add your logo image
                size_hint: None, None
                size: dp(80), dp(80)  # Smaller logo size
                pos_hint: {'center_x': 0.5}
                allow_stretch: True
                keep_ratio: True

            Label:
                text: '[b]PERSONAL INFORMATION[/b]'
                font_size: '18sp'  # Smaller font
                color: 0.223, 0.510, 0.478, 1
                markup: True
                size_hint_y: None
                height: dp(25)
                pos_hint: {'center_x': 0.5}
                halign: 'center'

            BoxLayout:
                orientation: 'vertical'
                size_hint_y: None
                height: dp(45)  # Reduced height
                TextInput:
                    id: first_name_input
                    hint_text: 'First Name'
                    size_hint_y: None
                    height: dp(35)
                    foreground_color: 0, 0, 0, 1
                    background_color: 0, 0, 0, 0
                    halign: 'center'
                    valign: 'middle'
                    multiline: False
                    write_tab: False
                    font_size: '14sp'
                    hint_text_color: 0.5, 0.5, 0.5, 1
                    on_focus: 
                        if self.focus: self.hint_text = ''; self.text = '' if self.text == 'First Name' else self.text
                        else: self.hint_text = 'First Name' if not self.text else ''
                    canvas.after:
                        Color:
                            rgba: 0, 0, 0, 1
                        Line:
                            points: self.x, self.y, self.right, self.y
                            width: 1

            BoxLayout:
                orientation: 'vertical'
                size_hint_y: None
                height: dp(45)
                TextInput:
                    id: last_name_input
                    hint_text: 'Last Name'
                    size_hint_y: None
                    height: dp(35)
                    background_normal: ''
                    background_active: ''
                    foreground_color: (0, 0, 0, 1)
                    background_color: (0, 0, 0, 0)
                    halign: 'center'
                    valign: 'middle'
                    multiline: False
                    write_tab: False
                    font_size: '14sp'
                    cursor_color: 0, 0, 0, 1
                    canvas.after:
                        Color:
                            rgba: (0, 0, 0, 1)
                        Line:
                            points: self.x, self.y, self.right, self.y
                            width: 1

            Label:
                text: 'Since this is a safety app, we recommend using your real full name'
                font_size: '12sp'  # Smaller font
                color: 0, 0, 0, 1
                size_hint_y: None
                height: dp(25)
                text_size: self.width, None
                halign: 'center'

            RelativeLayout:
                size_hint_y: None
                height: dp(35)
                TextInput:
                    id: dob_input
                    text: ''
                    hint_text: 'DOB (DD/MM/YYYY)'
                    size_hint: 1, None
                    height: dp(35)
                    readonly: True
                    foreground_color: 0, 0, 0, 1
                    background_color: 0, 0, 0, 0
                    halign: 'center'
                    valign: 'middle'
                    font_size: '14sp'
                    hint_text_color: 0.5, 0.5, 0.5, 1
                    on_focus: 
                        if self.focus: self.hint_text = ''; self.text = '' if self.text == 'DOB (DD/MM/YYYY)' else self.text
                        else: self.hint_text = 'DOB (DD/MM/YYYY)' if not self.text else ''
                    canvas.after:
                        Color:
                            rgba: 0, 0, 0, 1
                        Line:
                            points: self.x, self.y, self.right, self.y
                            width: 1

                BoxLayout:
                    orientation: 'horizontal'
                    size_hint: None, None
                    size: dp(100), dp(30)
                    pos_hint: {'right': 0.98, 'center_y': 0.5}  # Moved back to right side
                    spacing: dp(2)

                    Spinner:
                        id: day_spinner
                        text: 'Day'
                        values: [str(i) for i in range(1, 32)]
                        size_hint: None, None
                        size: dp(30), dp(30)  # Reduced width from 35 to 30
                        background_color: 0, 0, 0, 0
                        color: 0, 0, 0, 1
                        font_size: '11sp'
                        canvas.before:
                            Color:
                                rgba: (0.223, 0.510, 0.478, 1)
                            Line:
                                rectangle: (self.x, self.y, self.width, self.height)
                        on_text: root.update_dob()

                    Spinner:
                        id: month_spinner
                        text: 'Month'
                        values: [str(i) for i in range(1, 13)]
                        size_hint: None, None
                        size: dp(30), dp(30)  # Reduced width from 35 to 30
                        background_color: 0, 0, 0, 0
                        color: 0, 0, 0, 1
                        font_size: '11sp'
                        canvas.before:
                            Color:
                                rgba: 0, 0, 0, 1
                            Line:
                                rectangle: (self.x, self.y, self.width, self.height)
                        on_text: root.update_dob()

                    Spinner:
                        id: year_spinner
                        text: 'Year'
                        values: [str(i) for i in range(1990, 2025)]
                        size_hint: None, None
                        size: dp(30), dp(30)  # Reduced width from 35 to 30
                        background_color: 0, 0, 0, 0
                        color: 0, 0, 0, 1
                        font_size: '11sp'
                        canvas.before:
                            Color:
                                rgba: 0, 0, 0, 1
                            Line:
                                rectangle: (self.x, self.y, self.width, self.height)
                        on_text: root.update_dob()

            BoxLayout:
                orientation: 'vertical'
                size_hint_y: None
                height: dp(60)  # Reduced height
                spacing: dp(5)

                Label:
                    text: 'Gender'
                    color: 0, 0, 0, 1
                    font_size: '14sp'  # Smaller font
                    halign: 'left'
                    size_hint_y: None
                    height: dp(20)
                    text_size: self.size

                BoxLayout:
                    orientation: 'horizontal'
                    size_hint_y: None
                    height: dp(35)  # Reduced height
                    spacing: dp(15)  # Reduced spacing
                    pos_hint: {'x': 0}

                    BoxLayout:
                        orientation: 'horizontal'
                        spacing: dp(5)
                        size_hint_x: None
                        width: dp(70)  # Reduced width

                        CheckBox:
                            id: male_checkbox
                            group: 'gender'
                            size_hint: None, None
                            size: dp(20), dp(20)  # Reduced size
                            canvas.before:
                                Color:
                                    rgba: (0.223, 0.510, 0.478, 1) if self.active else (0, 0, 0, 1)
                                Line:
                                    circle: (self.center_x, self.center_y, min(self.width, self.height) / 2)
                            canvas.after:
                                Color:
                                    rgba: (0.223, 0.510, 0.478, 1) if self.active else (1, 1, 1, 0)
                                Ellipse:
                                    pos: self.center_x - min(self.width, self.height)/4, self.center_y - min(self.width, self.height)/4
                                    size: min(self.width, self.height)/2, min(self.width, self.height)/2

                        Label:
                            text: 'Male'
                            color: 0, 0, 0, 1
                            font_size: '12sp'  # Smaller font
                            size_hint_y: None
                            height: dp(20)

                    BoxLayout:
                        orientation: 'horizontal'
                        spacing: dp(5)
                        size_hint_x: None
                        width: dp(70)  # Reduced width

                        CheckBox:
                            id: female_checkbox
                            group: 'gender'
                            size_hint: None, None
                            size: dp(20), dp(20)  # Reduced size
                            canvas.before:
                                Color:
                                    rgba: (0.223, 0.510, 0.478, 1) if self.active else (0, 0, 0, 1)
                                Line:
                                    circle: (self.center_x, self.center_y, min(self.width, self.height) / 2)
                            canvas.after:
                                Color:
                                    rgba: (0.223, 0.510, 0.478, 1) if self.active else (1, 1, 1, 0)
                                Ellipse:
                                    pos: self.center_x - min(self.width, self.height)/4, self.center_y - min(self.width, self.height)/4
                                    size: min(self.width, self.height)/2, min(self.width, self.height)/2

                        Label:
                            text: 'Female'
                            color: 0, 0, 0, 1
                            font_size: '12sp'  # Smaller font
                            size_hint_y: None
                            height: dp(20)

                    BoxLayout:
                        orientation: 'horizontal'
                        spacing: dp(5)
                        size_hint_x: None
                        width: dp(70)  # Reduced width

                        CheckBox:
                            id: other_checkbox
                            group: 'gender'
                            size_hint: None, None
                            size: dp(20), dp(20)  # Reduced size
                            canvas.before:
                                Color:
                                    rgba: (0.223, 0.510, 0.478, 1) if self.active else (0, 0, 0, 1)
                                Line:
                                    circle: (self.center_x, self.center_y, min(self.width, self.height) / 2)
                            canvas.after:
                                Color:
                                    rgba: (0.223, 0.510, 0.478, 1) if self.active else (1, 1, 1, 0)
                                Ellipse:
                                    pos: self.center_x - min(self.width, self.height)/4, self.center_y - min(self.width, self.height)/4
                                    size: min(self.width, self.height)/2, min(self.width, self.height)/2

                        Label:
                            text: 'Others'
                            color: 0, 0, 0, 1
                            font_size: '12sp'  # Smaller font
                            size_hint_y: None
                            height: dp(20)

            Label:
                text: 'Select Your Primary Use Case'
                font_size: '14sp'  # Smaller font
                color: 0, 0, 0, 1
                size_hint_y: None
                height: dp(25)
                halign: 'left'
                text_size: self.size

            BoxLayout:
                orientation: 'vertical'
                size_hint_y: None
                height: dp(40)  # Reduced height
                Spinner:
                    id: use_case_spinner
                    text: 'Primary Use Case'
                    values: ['Personal Safety', 'Medical Emergencies', 'Travel Safety', 'Work & Campus Security']
                    size_hint_y: None
                    height: dp(35)  # Reduced height
                    background_color: 0, 0, 0, 0
                    color: (0.5, 0.5, 0.5, 1) if self.text == 'Primary Use Case' else (0, 0, 0, 1)
                    font_size: '14sp'  # Smaller font
                    canvas.before:
                        Color:
                            rgba: 0, 0, 0, 1
                        Line:
                            points: self.x, self.y, self.right, self.y
                            width: 1

            Widget:
                size_hint_y: None
                height: dp(15)  # Reduced spacing

            Button:
                text: "Done"
                size_hint: None, None
                size: dp(150), dp(40)  # Reduced size
                background_color: 0, 0, 0, 0
                pos_hint: {'center_x': 0.5}
                color: 1, 1, 1, 1
                font_size: '16sp'  # Smaller font
                canvas.before:
                    Color:
                        rgba: (0.223, 0.510, 0.478, 1)
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [20]
                on_press: root.submit_form()

            Widget:
                size_hint_y: None
                height: dp(15)  # Reduced spacing